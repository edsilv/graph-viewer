<!--
http://bl.ocks.org/mbostock/1093130
-->
<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Force Layout Example 1</title>
    <style>

        * {
            margin: 0;
            padding: 0;
        }

        html, body {
            width: 100%;
            height: 100%;
        }

        g.node circle {
            cursor: pointer;
            stroke: #3182bd;
            stroke-width: 1.5px;
        }

        g.node text {
            font: 10px sans-serif;
            pointer-events: none;
            text-anchor: middle;
        }

        line.link {
            fill: none;
            stroke: #9ecae1;
            stroke-width: 1.5px;
        }

    </style>
</head>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="bower_components/lodash/lodash.js"></script>
<script>

    var width = 800;// window.innerWidth,
        height = 600;// window.innerHeight;

    var graph = {
            "creativeWork": [
                { id: "Wunschendorf" },
                { id: "AndOnlyFineThreads" },
                { id: "TheShore" },
                { id: "ScholtzsHouse" },
                { id: "LaMortedlarbe" },
                { id: "TheArtofNarrative" }
            ],
            "subject": [
                { id: "Memory" },
                { id: "Identity" },
                { id: "Mining" },
                { id: "Exile" },
                { id: "Storytelling" }
            ],
            "type": [
                { id: "MovingImage" },
                { id: "Text" }
            ],
            "creativeWorkSubject": [
                { "source": 0, "target": 6 },
                { "source": 0, "target": 9 },
                { "source": 1, "target": 6 },
                { "source": 2, "target": 7 },
                { "source": 3, "target": 7 },
                { "source": 3, "target": 9 },
                { "source": 4, "target": 7 },
                { "source": 4, "target": 8 },
                { "source": 5, "target": 10 }
            ],
            "creativeWorkType": [
                { "source": 0, "target": 6 },
                { "source": 1, "target": 7 },
                { "source": 2, "target": 6 },
                { "source": 3, "target": 6 },
                { "source": 4, "target": 6 },
                { "source": 5, "target": 7 }
            ]
    };

    var svg = d3.select('body').append('svg')
            .attr('width', width)
            .attr('height', height);

    var subject = true;

    var force = d3.layout.force()
            .size([width, height])
            .gravity(.05)
            .distance(100)
            .charge(-100)
            .on('tick', tick);

    svg.on('click', function() {
        subject = !subject;
        update();
    });

    var link = svg.selectAll('.link');
    var node = svg.selectAll('.node');

    function update() {
        var nodes, links; nodes

        if (subject){
            nodes = graph.creativeWork.concat(graph.subject);
            links = graph.creativeWorkSubject;
        } else {
            nodes = graph.creativeWork.concat(graph.type);
            links = graph.creativeWorkType;
        }

        // Restart the force layout.
        force.nodes(nodes)
                .links(links)
                .start();

        // Update links.
        link = link.data(links);

        link.exit().remove();

        link.enter().insert("line", ".node")
                .attr("class", "link");

        // Update nodes.
        node = node.data(nodes, function(d) {
            return d.id;
        });

        node.exit().remove();

        var nodeEnter = node.enter()
                .append("g")
                .attr("class", "node")
                .on("click", click)
                .call(force.drag);

        nodeEnter.append("circle")
                .attr("r", function(d) { return 10; });

        nodeEnter.append("text")
                .attr("dy", ".35em")
                .text(function(d) { return d.id; });

        node.select("circle")
                .style("fill", color);
    }


    function tick() {

        link.attr('x1', function(d) { return d.source.x; })
                .attr('y1', function(d) { return d.source.y; })
                .attr('x2', function(d) { return d.target.x; })
                .attr('y2', function(d) { return d.target.y; });

        node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
    }

    function color(d) {
        return d._children ? "#3182bd" // collapsed package
                : d.children ? "#c6dbef" // expanded package
                : "#fd8d3c"; // leaf node
    }

    function click(d) {
        if (d3.event.defaultPrevented) return; // ignore drag
        console.log(d.id);
        update();
    }

    update();

</script>
</body>
</html>