<!--
http://bl.ocks.org/mbostock/1093130
-->
<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Force Layout Example 1</title>
    <style>

        * {
            margin: 0;
            padding: 0;
        }

        html, body {
            width: 100%;
            height: 100%;
        }

        g.node text {
            font-size: 20px;
            font-family: 'PT Sans', sans-serif;
            pointer-events: none;
            text-anchor: middle;
        }

        g.node text.category {
            font-weight: bold;
        }

        g.node text.creativeWork {

        }

        line.link {
            fill: none;
            stroke: #e3dfe3;
            stroke-width: 1.5px;
        }

    </style>
    <link href='http://fonts.googleapis.com/css?family=PT+Sans' rel='stylesheet' type='text/css'>
</head>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="bower_components/lodash/lodash.js"></script>
<script>

    var width = window.innerWidth,
        height = window.innerHeight;

    var graph = {
            "nodes": [
                { "type": "creativeWork", "id": "Wunschendorf", "name": "Wunschendorf" },
                { "type": "creativeWork", "id": "AndOnlyFineThreads", "name": "AndOnlyFineThreads" },
                { "type": "creativeWork", "id": "TheShore", "name": "The Shore" },
                { "type": "creativeWork", "id": "ScholtzsHouse", "name": "Scholtz's House" },
                { "type": "creativeWork", "id": "LaMortedlarbe", "name": "La Morte d'larbe" },
                { "type": "creativeWork", "id": "TheArtofNarrative", "name": "The Art of Narrative" },
                { "type": "subject", id: "Memory", "name": "Memory" },
                { "type": "subject", id: "Identity", "name": "Identity" },
                { "type": "subject", id: "Mining", "name": "Mining" },
                { "type": "subject", id: "Exile", "name": "Exile" },
                { "type": "subject", id: "Storytelling", "name": "Storytelling" },
                { "type": "type", id: "MovingImage", "name": "Film" },
                { "type": "type", id: "Text", "name": "Text" }
            ],
            "creativeWorkSubject": [
                { "source": 0, "target": 6 },
                { "source": 0, "target": 9 },
                { "source": 1, "target": 6 },
                { "source": 2, "target": 7 },
                { "source": 3, "target": 7 },
                { "source": 3, "target": 9 },
                { "source": 4, "target": 7 },
                { "source": 4, "target": 8 },
                { "source": 5, "target": 10 }
            ],
            "creativeWorkType": [
                { "source": 0, "target": 6 },
                { "source": 1, "target": 7 },
                { "source": 2, "target": 6 },
                { "source": 3, "target": 6 },
                { "source": 4, "target": 6 },
                { "source": 5, "target": 7 }
            ]
    };

    var svg = d3.select('body').append('svg')
            .attr('width', width)
            .attr('height', height);

    var force = d3.layout.force()
            .size([width, height])
            .gravity(.05)
            .distance(250)
            .charge(-1000)
            .friction(.6)
            .on('tick', tick);

    var subject = true;

    svg.on('click', function() {
        subject = !subject;
        update();
    });

    var link = svg.selectAll('.link');
    var node = svg.selectAll('.node');

    function update() {
        var nodes, links;

        if (subject){

            nodes = _.filter(graph.nodes, function(n) {
                return n.type === "creativeWork" || n.type === "subject";
            });

            links = graph.creativeWorkSubject;

        } else {

            nodes = _.filter(graph.nodes, function(n) {
                return n.type === "creativeWork" || n.type === "type";
            });

            links = graph.creativeWorkType;
        }

        // Restart the force layout.
        force.nodes(nodes)
                .links(links)
                .start();

        // Update links.
        link = link.data(links);

        link.exit().remove();

        link.enter().insert("line")
                .attr("class", "link");

        // Update nodes.
        node = node.data(nodes, function(d) {
            return d.id;
        });

        node.exit().remove();

        var nodeEnter = node.enter()
                .append("g")
                .attr("class", "node")
                .on("click", click)
                .call(force.drag);

        nodeEnter.append("text")
                .attr("class", function(d){
                    if(d.type === "creativeWork"){
                        return 'creativeWork';
                    }
                    return 'category';
                })
                .attr("fill", color)
                .attr("dy", ".35em")
                .text(function(d) { return d.name; });

        node.select("circle")
                .style("fill", color);
    }

    function tick() {

        link.attr('x1', function(d) { return d.source.x; })
                .attr('y1', function(d) { return d.source.y; })
                .attr('x2', function(d) { return d.target.x; })
                .attr('y2', function(d) { return d.target.y; });

        node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
    }

    function color(d) {
        return d.type === "creativeWork" ? "#9a969a" : "#535253";
    }

    function click(d) {
        if (d3.event.defaultPrevented) return; // ignore drag
        console.log(d.id);
        update();
    }

    update();

</script>
</body>
</html>