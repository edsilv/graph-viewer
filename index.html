<!--
http://bl.ocks.org/mbostock/1093130
-->
<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Force Layout Example 1</title>
    <style>

        * {
            margin: 0;
            padding: 0;
        }

        html, body {
            width: 100%;
            height: 100%;
        }

        g.node text {
            font: 20px sans-serif;
            pointer-events: none;
            text-anchor: middle;
        }

        g.node text.category {
            font-weight: bold;
        }

        g.node text.creativeWork {

        }

        line.link {
            fill: none;
            stroke: #d6d2d6;
            stroke-width: 1.5px;
        }

    </style>
</head>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="bower_components/lodash/lodash.js"></script>
<script>

    var width = window.innerWidth,
        height = window.innerHeight;

    var graph = {
            "nodes": [
                { "type": "creativeWork", "id": "Wunschendorf" },
                { "type": "creativeWork", "id": "AndOnlyFineThreads" },
                { "type": "creativeWork", "id": "TheShore" },
                { "type": "creativeWork", "id": "ScholtzsHouse" },
                { "type": "creativeWork", "id": "LaMortedlarbe" },
                { "type": "creativeWork", "id": "TheArtofNarrative" },
                { "type": "subject", id: "Memory" },
                { "type": "subject", id: "Identity" },
                { "type": "subject", id: "Mining" },
                { "type": "subject", id: "Exile" },
                { "type": "subject", id: "Storytelling" },
                { "type": "type", id: "MovingImage" },
                { "type": "type", id: "Text" }
            ],
            "creativeWorkSubject": [
                { "source": 0, "target": 6 },
                { "source": 0, "target": 9 },
                { "source": 1, "target": 6 },
                { "source": 2, "target": 7 },
                { "source": 3, "target": 7 },
                { "source": 3, "target": 9 },
                { "source": 4, "target": 7 },
                { "source": 4, "target": 8 },
                { "source": 5, "target": 10 }
            ],
            "creativeWorkType": [
                { "source": 0, "target": 6 },
                { "source": 1, "target": 7 },
                { "source": 2, "target": 6 },
                { "source": 3, "target": 6 },
                { "source": 4, "target": 6 },
                { "source": 5, "target": 7 }
            ]
    };

    var svg = d3.select('body').append('svg')
            .attr('width', width)
            .attr('height', height);

    var subject = true;

    var force = d3.layout.force()
            .size([width, height])
            .gravity(.05)
            .distance(250)
            .charge(-1000)
            .friction(.5)
            .on('tick', tick);

    svg.on('click', function() {
        subject = !subject;
        update();
    });

    var link = svg.selectAll('.link');
    var node = svg.selectAll('.node');

    function update() {
        var nodes, links;

        if (subject){
            nodes = _.filter(graph.nodes, function(n) {
                return n.type === "creativeWork" || n.type === "subject";
            });
            links = graph.creativeWorkSubject;
        } else {
            nodes = _.filter(graph.nodes, function(n) {
                return n.type === "creativeWork" || n.type === "type";
            });
            links = graph.creativeWorkType;
        }

        // Restart the force layout.
        force.nodes(nodes)
                .links(links)
                .start();

        // Update links.
        link = link.data(links);

        link.exit().remove();

        link.enter().insert("line", ".node")
                .attr("class", "link");

        // Update nodes.
        node = node.data(nodes, function(d) {
            return d.id;
        });

        node.exit().remove();

        var nodeEnter = node.enter()
                .append("g")
                .attr("class", "node")
                .on("click", click)
                .call(force.drag);

//        nodeEnter.append("circle")
//                .attr("r", function(d) { return 10; });

        nodeEnter.append("text")
                .attr("class", function(d){
                    if(d.type === "creativeWork"){
                        return 'creativeWork';
                    }
                    return 'category';
                })
                .attr("fill", color)
                .attr("dy", ".35em")
                .text(function(d) { return d.id; });

        node.select("circle")
                .style("fill", color);
    }


    function tick() {

        link.attr('x1', function(d) { return d.source.x; })
                .attr('y1', function(d) { return d.source.y; })
                .attr('x2', function(d) { return d.target.x; })
                .attr('y2', function(d) { return d.target.y; });

        node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
    }

    function color(d) {
        return d.type === "creativeWork" ? "#9a969a" : "#535253";
    }

    function click(d) {
        if (d3.event.defaultPrevented) return; // ignore drag
        console.log(d.id);
        update();
    }

    update();

</script>
</body>
</html>